#!/usr/bin/env python3
from http.server import BaseHTTPRequestHandler, HTTPServer
import os

LOG_FILE = "/home/ubuntu/instance.log"  # Adjust path as needed
PORT = 8000

class LogHandler(BaseHTTPRequestHandler):
    def _set_headers(self):
        self.send_response(200)
        self.send_header("Content-type", "text/plain; charset=utf-8")
        self.send_header("Access-Control-Allow-Origin", "*")
        self.send_header("Access-Control-Allow-Methods", "GET, OPTIONS")
        self.send_header("Access-Control-Allow-Headers", "*")
        self.end_headers()

    def do_OPTIONS(self):
        self._set_headers()

    def do_GET(self):
        self._set_headers()

        if os.path.exists(LOG_FILE):
            with open(LOG_FILE, "rb") as f:
                content = f.readlines()[-50:]  # last 50 lines
                self.wfile.write(b"".join(content))
        else:
            self.wfile.write(b"Log file not found.")

if __name__ == "__main__":
    print(f"ðŸš€ Starting log server on port {PORT}...")
    server = HTTPServer(("0.0.0.0", PORT), LogHandler)
    server.serve_forever()
